[2025-12-11 00:29:16] [INFO] === INICIO procesar_pedido_directo.php ===
--------------------------------------------------------------------------------
[2025-12-11 00:29:16] [INFO] Método HTTP: POST
--------------------------------------------------------------------------------
[2025-12-11 00:29:16] [INFO] IP Cliente: 38.250.148.72
--------------------------------------------------------------------------------
[2025-12-11 00:29:16] [INFO] User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36 Edg/143.0.0.0
--------------------------------------------------------------------------------
[2025-12-11 00:29:16] [INFO] Conectando a BD: allwiya_allwiya_gustavo en 127.0.0.1
--------------------------------------------------------------------------------
[2025-12-11 00:29:16] [INFO] ✓ Conexión a BD exitosa
--------------------------------------------------------------------------------
[2025-12-11 00:29:16] [INFO] Validando tabla tb_estados...
--------------------------------------------------------------------------------
[2025-12-11 00:29:16] [INFO] ✓ Tabla tb_estados OK - Estado PENDIENTE existe
--------------------------------------------------------------------------------
[2025-12-11 00:29:16] [INFO] Raw input recibido (primeros 500 chars)
                      Datos: "{\"tipo_pedido\":\"para_llevar\",\"cliente\":{\"nombre\":\"Reyhan\",\"telefono\":\"920572674\",\"direccion\":null,\"mesa\":null,\"email\":null},\"productos\":[{\"id\":4,\"nombre\":\"1 POLLO\",\"precio\":50,\"cantidad\":1,\"observaciones\":null}],\"metodo_pago\":\"yape\",\"observaciones\":\"\",\"subtotal\":50,\"descuento\":0,\"costo_delivery\":0,\"total\":50}"
--------------------------------------------------------------------------------
[2025-12-11 00:29:16] [INFO] ✓ JSON decodificado correctamente
                      Datos: [
    "tipo_pedido",
    "cliente",
    "productos",
    "metodo_pago",
    "observaciones",
    "subtotal",
    "descuento",
    "costo_delivery",
    "total"
]
--------------------------------------------------------------------------------
[2025-12-11 00:29:16] [INFO] Cliente: Reyhan, Tel: 920572674, Dir: 
--------------------------------------------------------------------------------
[2025-12-11 00:29:16] [INFO] Tipo pedido: para_llevar
--------------------------------------------------------------------------------
[2025-12-11 00:29:16] [INFO] Productos: 1
                      Datos: [
    {
        "id": 4,
        "nombre": "1 POLLO",
        "precio": 50,
        "cantidad": 1,
        "observaciones": null
    }
]
--------------------------------------------------------------------------------
[2025-12-11 00:29:16] [INFO] ✓ Cliente existente encontrado
                      Datos: {
    "id": 10,
    "nombre": "Reyhan"
}
--------------------------------------------------------------------------------
[2025-12-11 00:29:16] [INFO] === INICIANDO TRANSACCIÓN ===
--------------------------------------------------------------------------------
[2025-12-11 00:29:16] [INFO] ✓ Número de pedido generado: PED-2025-502220
--------------------------------------------------------------------------------
[2025-12-11 00:29:16] [INFO] ✓ Método de pago seleccionado: yape
--------------------------------------------------------------------------------
[2025-12-11 00:29:16] [INFO] ✓ Validaciones finales
                      Datos: {
    "tipo_pedido": "para_llevar",
    "direccion_final": null,
    "mesa_final": null,
    "metodo_pago": "yape"
}
--------------------------------------------------------------------------------
[2025-12-11 00:29:16] [INFO] ✓ Pedido creado en BD
                      Datos: {
    "id": "43",
    "nro": "PED-2025-502220"
}
--------------------------------------------------------------------------------
[2025-12-11 00:29:16] [INFO] ✓ Método de pago mapeado
                      Datos: {
    "metodo_texto": "yape",
    "id_metodo_pago": 3
}
--------------------------------------------------------------------------------
[2025-12-11 00:29:16] [INFO] ✓ Venta creada (pendiente)
                      Datos: {
    "id_venta": "20",
    "nro_venta": 13,
    "id_metodo_pago": 3,
    "estado": "pendiente"
}
--------------------------------------------------------------------------------
[2025-12-11 00:29:16] [INFO] ✓ Detalles de venta insertados
--------------------------------------------------------------------------------
[2025-12-11 00:29:16] [INFO] ✓ Pedido vinculado con venta
                      Datos: {
    "id_venta": "20"
}
--------------------------------------------------------------------------------
[2025-12-11 00:29:16] [INFO] ✓ Detalles del pedido insertados y stock actualizado
                      Datos: {
    "items": 1
}
--------------------------------------------------------------------------------
[2025-12-11 00:29:16] [INFO] === ✅ PEDIDO COMPLETADO EXITOSAMENTE ===
                      Datos: {
    "id_pedido": "43",
    "nro_pedido": "PED-2025-502220",
    "cliente_id": 10,
    "total": 50,
    "productos": 1
}
--------------------------------------------------------------------------------
[2025-12-11 00:29:16] [INFO] === FIN procesar_pedido_directo.php ===
--------------------------------------------------------------------------------
